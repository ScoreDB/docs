---
title: StudentDB
description: ''
position: 4
category: Endpoints
---

以下为 StudentDB 相关的 API 列表。

<alert type="warning">
以下所有示例中数据均为不真实数据，若有”...“代表省略了多条相同结构数据。
</alert>

## 年级信息

### 获取所有年级
#### 请求：`GET /studentdb/grades`
#### 需要的权限：<badge>studentdb:read</badge>
#### 响应示例：
```json
[
  // 条目按年级 ID 升序排列
  {
    "id": "C12",          // 年级 ID
    "classesCount": 10,   // 此年级的班级数
    "studentsCount": 384  // 此年级的学生数
  },
  {
    "id": "G12",
    "classesCount": 9,
    "studentsCount": 293
  },
  ...
]
```

### 获取单个年级信息
#### 请求：`GET /studentdb/grades/{gradeId}`
#### 需要的权限：<badge>studentdb:read</badge>
#### 参数：
URL 中 `{gradeId}` 为要请求的**年级 ID**。
#### 响应示例：
```json
{
  "id": "C12",
  "classes": [
    // 此年级中的班级列表，按班级 ID 升序排列
    {
      "id": "C1201",       // 班级 ID
      "studentsCount": 37  // 此班级的学生数
    },
    {
      "id": "C1202",
      "studentsCount": 39
    },
    ...
  ],
  "classesCount": 10,   // 此年级的班级数
  "studentsCount": 384  // 此年级的学生数
}
```
#### 错误处理：
若未找到请求的年级，将返回 **404** 错误。

## 班级信息

### 获取单个年级的班级列表
请参考[获取单个年级信息](#获取单个年级信息)。

### 获取单个班级信息
#### 请求：`GET /studentdb/classes/{classId}`
#### 需要的权限：<badge>studentdb:read</badge>
#### 参数：
URL 中 `{classId}` 为要请求的**班级 ID**。
#### 响应示例：
```json
{
    "id": "C1201",
    "gradeId": "C12",  // 此班级所属年级 ID
    "students": [
        {
            "id": "C120101",  // 学生学号
            "name": "学生 A",  // 学生姓名
            "gender": "女"     // 学生性别
        },
        {
            "id": "C120102",
            "name": "学生 B",
            "gender": "男"
        },
    ],
    "studentsCount": 37  // 此班级学生总数
}
```
#### 错误处理：
若未找到请求的班级，将返回 **404** 错误。

## 学生信息

### 获取单个班级的学生列表
请参考[获取单个班级信息](#获取单个班级信息)。

### 获取单个学生信息
#### 请求：`GET /studentdb/students/{id}`
#### 需要的权限：<badge>studentdb:read</badge>
#### 参数：
URL 中 `{id}` 可为学生**学号**或**教育 ID**。  
可以通过 `photos` 参数指定是否需要同时返回学生的照片 URL 列表，默认为 `false`。
#### 错误处理：
若未找到请求的学生，将返回 **404** 错误。

### 搜索学生
#### 请求：`GET /studentdb/students/search`
#### 需要的权限：<badge>studentdb:read</badge>
#### 频率限制：**每分钟最多 20 次**
#### 参数：
可以通过 `query` 参数传入要搜索的内容，如 `.../search?query=abc`。
#### 搜索筛选逻辑：

<alert type="info">
这是对 StudentDB 搜索时使用子请求筛选结果逻辑的详细介绍，若不感兴趣可以跳过，但了解这些内容有助于你理解子请求的用法，更好地使用此 API。
</alert>

StudentDB 的搜索针对学生的**姓名**和**姓名拼音**进行搜索，你可以通过 `query` 参数传入传入你要搜索的内容，这一值被称为 `rawQuery`（原始请求）。

原始请求会被以**空格**为分隔符拆分 (`split`) 成若干个部分，称为 `childQueries`（子请求）。

子请求会被用来按以下顺序匹配正则表达式：

 - 若子请求符合 `(^[xXcCgG][0-9]{6}$)|(^[0-9]{8}$)$`，则认为这一请求是一个学生 ID，**结果中将只有这一名学生**。 
 - 若子请求符合 `^[xXcCgG][0-9]{4}$`，则认为这一子请求是在指定要搜索的班级范围。
 - `^[xXcCgG][0-9]{2}$`，则认为这一子请求是在指定要搜索的年级范围。

**一次请求的所有子请求中只有最多一个会被认定为搜索条件**，即以上正则表达式匹配到结果后会直接忽略更多子请求。

完成上述匹配后，未被匹配到的子请求将重新被组合，成为 `processedQuery`（处理后请求）。

最后，StudentDB 将用处理后请求和搜索条件一起在数据库中搜索，返回最终结果。

#### 搜索示例：
 - 输入：`abc` — 搜索所有姓名或拼音中带有 `abc` 的学生
 - 输入：`c12 abc` — 搜索 `C12` 年级中姓名或拼音中带有 `abc` 的学生
 - 输入：`c1211 abc` — 搜索 `C1211` 班姓名或拼音中带有 `abc` 的学生
 - 输入：`c12 c1211 abc` — 搜索 `C1211` 班姓名或拼音中带有 `abc` 的学生，因为 `c1211` 会比 `c12` 先被匹配到
 - 输入：`abc foo` — 搜索所有姓名或拼音中带有 `abc foo` 的学生
 - 输入：`c121112` — 只搜索学号为 `C121112` 的学生
 - 输入：`c121112 abc` — 只搜索学号为 `C121112` 的学生，因为输入学号会阻断接下来的搜索，直接返回信息
 - 输入：`c1211` — 此时 `processedQuery` 为空，会返回 `C1211` 班所有学生（不推荐这样的用法，建议直接使用 [获取单个班级的学生列表](#获取单个年级信息)）。

### 自定义请求
*此 API 尚未完成*
